import { BaseUrlField } from "@/app/(sidebar)/user-settings/api/base-url-field";
import { ApiKeyField } from "@/app/(sidebar)/user-settings/api/api-key-field";
import { ANTHROPIC_API_BASE_URL, OPENAI_API_BASE_URL } from "@/app/(sidebar)/user-settings/api/page";
import { getOrCreateApiKey } from "@/app/api/api-key/api-key-data-layer";
import { Pre, Code } from "@/app/components/typography"
import CodeTabs from "@/app/components/ui/code-tabs"
import { Alert, AlertTitle, AlertDescription } from "@/app/components/ui/alert";
import { InfoIcon } from "lucide-react";
import MessageSchemas from "../message-schemas.mdx";

export const metadata = {
  title: "/messages",
};

# Messages API

<Pre><Code>POST {ANTHROPIC_API_BASE_URL}/messages</Code></Pre>

Send and receive messages.

<Alert className="mb-4">
  <InfoIcon color="#00bb00" />
  <AlertTitle>Tip</AlertTitle>
  <AlertDescription>
    <p>To learn how to set up Claude Code with Synthetic, see our [Claude Code](/docs/guides/claude-code) guide!</p>
  </AlertDescription>
</Alert>

## Request Body

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `model` | string | Yes | Model name (must be prefixed with `hf:`). See supported [Models](/docs/api/models). |
| `max_tokens` | number | Yes | Maximum number of tokens to generate |
| `messages` | array | Yes | Array of [message](#message-object) objects |
| `stream` | boolean | No | Whether to stream the response |
| `system` | string/array | No | System message(s) - can be string or array of [system message objects](#system-message-object) |
| `stop_sequences` | array | No | Stop sequences |
| `temperature` | number | No | Sampling temperature |
| `tool_choice` | object | No | Control tool calling: `auto`, `any`, `none`, or specific tool |
| `tools` | array | No | List of tools the model may call |
| `top_k` | number | No | Limit sampling to top K tokens |
| `top_p` | number | No | Nucleus sampling parameter |

<MessageSchemas />

## Example Usage

export const messagesExamples = [{
  title: "Python",
  language: "python",
  source: `import anthropic

client = anthropic.Anthropic(
    api_key="SYNTHETIC_API_KEY",
    base_url="${ANTHROPIC_API_BASE_URL}"
)

response = client.messages.create(
    model="hf:deepseek-ai/DeepSeek-V3-0324",
    max_tokens=100,
    messages=[
        {"role": "user", "content": "What is the capital of France?"}
    ]
)

print(response.content[0].text)`,
}, {
  title: "TypeScript",
  language: "typescript",
  source: `import Anthropic from "@anthropic-ai/sdk";

const client = new Anthropic({
    apiKey: "SYNTHETIC_API_KEY",
    baseURL: "${ANTHROPIC_API_BASE_URL}"
});

const response = await client.messages.create({
    model: "hf:deepseek-ai/DeepSeek-V3-0324",
    max_tokens: 100,
    messages: [
        { role: "user", content: "What is the capital of France?" }
    ]
});

console.log(response.content[0].text);`,
}, {
  title: "curl",
  language: "bash",
  source: `curl -X POST ${ANTHROPIC_API_BASE_URL}/messages \\
  -H "Authorization: Bearer \${SYNTHETIC_API_KEY}" \\
  -H "Content-Type: application/json" \\
  -H "anthropic-version: 2023-06-01" \\
  -d '{
    "model": "hf:deepseek-ai/DeepSeek-V3-0324",
    "max_tokens": 100,
    "messages": [
      {
        "role": "user",
        "content": "What is the capital of France?"
      }
    ]
  }'`,
}];

<CodeTabs className="mb-4" code={messagesExamples} />

## Example Response

```json
{
  "id": "msg_abc123",
  "type": "message",
  "role": "assistant",
  "content": [
    {
      "type": "text",
      "text": "The capital of France is Paris."
    }
  ],
  "model": "hf:deepseek-ai/DeepSeek-V3-0324",
  "stop_reason": "end_turn",
  "stop_sequence": null,
  "usage": {
    "input_tokens": 12,
    "output_tokens": 8
  }
}
```

## Streaming

When `stream: true` is set, the response will be a series of Server-Sent Events:

export const streamingExamples = [{
  title: "Python",
  language: "python",
  source: `stream = client.messages.create(
    model="hf:deepseek-ai/DeepSeek-V3-0324",
    max_tokens=100,
    system="You are a helpful assistant.",
    messages=[{"role": "user", "content": "Hello!"}],
    stream=True
)

for event in stream:
    if event.type == "content_block_delta":
        print(event.delta.text, end="")`,
}, {
  title: "TypeScript",
  language: "typescript",
  source: `const stream = await client.messages.create({
    model: "hf:deepseek-ai/DeepSeek-V3-0324",
    max_tokens: 100,
    system: "You are a helpful assistant.",
    messages: [{ role: "user", content: "Hello!" }],
    stream: true
});

for await (const event of stream) {
    if (event.type === "content_block_delta") {
        process.stdout.write(event.delta.text);
    }
}`,
}, {
  title: "curl",
  language: "bash",
  source: `curl -X POST ${ANTHROPIC_API_BASE_URL}/messages \\
  -H "Authorization: Bearer \${SYNTHETIC_API_KEY}" \\
  -H "Content-Type: application/json" \\
  -H "anthropic-version: 2023-06-01" \\
  -d '{
    "model": "hf:deepseek-ai/DeepSeek-V3-0324",
    "max_tokens": 100,
    "system": "You are a helpful assistant.",
    "messages": [
      {
        "role": "user",
        "content": "Hello!"
      }
    ],
    "stream": true
  }'`,
}];

<CodeTabs className="mb-4" code={streamingExamples} />
